<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>Security Advisory - Internship Ramblings</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Security Advisory";
        var mkdocs_page_input_path = "research/subdomain-takeover/findings/security-advisory.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> Internship Ramblings
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">OWASP</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../OWASP/api/">Api</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SAML</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../SAML/saml_notes/">SAML</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Audits</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../audits/PoC/">Coverflex</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../audits/neurowave/">NEUROWAVE, LDA</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Ctfs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Capital ctf</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../ctfs/capital-ctf/">Index</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Dvga</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../ctfs/dvga/dvga/">Dvga</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dvwss</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../dvwss/notes/">Notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Goatlin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../goatlin/notes/">Goatlin Notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../notes/api_types/">Api types</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../notes/http2/">Http2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../notes/nosqli/">NoSQL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../notes/sql/">SQL - Structured Query Language</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Portswigger</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../portswigger/labs/">PortSwigger labs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Quiz</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../quiz/SecurityChampion/">QUIZ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Research</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../../angular_notes/">Angular</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../dangling%20markup/">Evading CSP with DOM-based dangling markup (PortSwigger) - An alternative approach</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Subdomain takeover</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../">Index</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Findings</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Security Advisory</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#description">Description</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#recommendations">Recommendations</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#references">References</a>
    </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Src</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="#">Commands</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../src/commands/commands/">Commands</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Script</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../src/script/">Index</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Techniques</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../techniques/interesting/">Techniques created by me (or not) uncommon in the wild</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../techniques/methodology/">A methodological checklist to logically deduce the steps needed to pentest a web app.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../techniques/triggers/">Errors based/behaviour inferer</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../tools/notes/">Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">Internship Ramblings</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Research &raquo;</li>
          <li>Subdomain takeover &raquo;</li>
          <li>Findings &raquo;</li>
      <li>Security Advisory</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>\setcounter{tocdepth}{1} 
\tableofcontents</p>
<h1 id="subdomain-takeover-ftpboxycharmcom-82-high">Subdomain Takeover - ftp.boxycharm.com (8.2 High)</h1>
<p><strong>CVSS Score:</strong> 8.2 (High) <a href="https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:H/A:N">CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:H/A:N</a></p>
<h2 id="description">Description</h2>
<p>On May 22th, 2023, as part of a broader Subdomain Takeover (STO) research, the
researchers found that the <code>ftp.boxycharm.com</code> subdomain was vulnerable to
subdomain takeover, by abusing a flaw in the service <code>Section.io</code>. This service allows users to 
host a web application and associate it with a subdomain or domain. 
It validates the DNS configurations by asserting the added subdomain 
has a <code>CNAME</code> record pointing to: <code>&lt;user subdomain&gt;.c.section.io</code>. So, 
if the user wanted to associate the subdomain <code>example.char49.com</code>, 
he'd have to create a CNAME: <code>example.char49.com.c.section.io</code>. 
The user's subdomain is then associated with section.io.</p>
<p><img alt="Subdomain Takeover of ftp.boxycharm.com" src="../assets/screenshots/figure-1.png" />{#fig:1}</p>
<p>In the following attack scenario, the subdomain: <code>ftp.boxycharm.com</code> does not 
point to <code>ftp.boxycharm.com.c.section.io</code>. It points to <code>boxycharm.com.c.section.io</code>, 
and this points to a valid IP inside section's range of IPs. 
However, there exists some sort of functionality in the <code>section.io</code> hosting logic, 
that marks the previously described validation steps as 
complete (or unnecessary), because <code>ftp.boxycharm.com</code> is already pointing to 
a valid IP inside section's range of ip's. Because of this, the validation step is seen as completed and
the DNS automatically propagates, so the project web application content is served in <code>ftp.boxycharm.com</code></p>
<p>A DNS query showed that the target points to <code>boxycharm.com.c.section.io</code> via
a <code>CNAME</code> record, which in turn points to the following IP addresses:
<code>207.120.37.202, 207.120.37.103, 207.120.37.109, 207.120.37.205, 207.120.37.106, 207.120.37.198, 207.120.37.104, 207.120.37.197</code></p>
<p><img alt="ftp.boxycharm.com DNS query" src="../assets/screenshots/figure-2.png" />{#fig:2}</p>
<p>In order to successfully exploit the subdomain takeover, 
an attacker must know the location of the target subdomain, 
and create a web application project, within section.io, with the exact same location. 
Section.io writes the virtual host inside the server with an IP assigned depending on the location selected.
Since the vulnerable domain already has a specific location and therefore an IP that clients will connect to when navigating there, 
in order for us to take it over, we have to ensure the IP's from the vulnerable web application and
the attacker's section.io project web application are the same. If they are, when he adds 
the vulnerable subdomain to his project, the virtual host corresponding to his web application project, 
will actually be written inside the server that your vulnerable subdomain (<code>ftp.boxycharm.com</code>) IP points to.
In case of ftp.boxycharm.com it is <code>London</code> (We infer by looking at the last domain in the <code>CNAME</code> chain).</p>
<p><img alt="DNS query revealing the correct location" src="../assets/screenshots/figure-3.png" />{#fig:3}</p>
<p>At this point the researchers had all the required information to takeover the subdomain. 
A new project was created, the locations matched, and the subdomain added to the project. After DNS
propagation, the contents were served to the subdomain.</p>
<h2 id="recommendations">Recommendations</h2>
<ul>
<li>Review DNS configuration and assure that all the aliases and delegations of
  subdomains to external domains (CNAME, DNAME, NS registers) do not expose
  these subdomains to takeovers.</li>
<li>Remove the cname chain of <code>ftp.boxycharm.com</code> if the domain is 
  unneeded or claim that domain within a section.io project if it is needed.</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.hackerone.com/application-security/guide-subdomain-takeovers">A Guide To Subdomain Takeovers - HackerOne</a></li>
<li><a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/10-Test_for_Subdomain_Takeover">Test for Subdomain Takeover - OWASP Web Application Security Testing</a></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../" class="btn btn-neutral float-left" title="Index"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../src/commands/commands/" class="btn btn-neutral float-right" title="Commands">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../src/commands/commands/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme_extra.js" defer></script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
